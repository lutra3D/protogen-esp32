<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ProtoGen Web Control</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f4f6fb;
      --panel: rgba(255, 255, 255, 0.94);
      --border: rgba(28, 39, 51, 0.16);
      --accent: #ff6f61;
    }
    body {
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      margin: 0;
      line-height: 1.45;
      background: radial-gradient(circle at 20% 20%, rgba(255, 179, 140, 0.18), transparent 46%),
        radial-gradient(circle at 80% 0%, rgba(107, 164, 255, 0.18), transparent 44%),
        var(--bg);
      color: #1c2733;
      min-height: 100vh;
    }
    .page {
      max-width: 880px;
      margin: 32px auto 48px;
      padding: 0 20px 32px;
    }
    h1 {
      margin: 0 0 24px;
      text-align: center;
      font-size: 2.2rem;
      letter-spacing: 0.02em;
      color: #18202a;
    }
    section {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 18px 20px 22px;
      margin-bottom: 22px;
      border-radius: 18px;
      box-shadow: 0 12px 28px rgba(23, 43, 77, 0.12);
      backdrop-filter: blur(7px);
    }
    section h2 {
      margin: 0 0 12px;
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #4e5d6c;
    }
    form {
      display: grid;
      gap: 12px;
    }
    label {
      font-weight: 600;
      color: #3b4a5a;
      display: block;
    }
    input,
    button {
      font: inherit;
      border-radius: 10px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.15s ease;
    }
    input[type="text"],
    input[type="file"],
    input[type="range"],
    input[type="color"] {
      border: 1px solid var(--border);
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.82);
      color: inherit;
    }
    input[type="file"] {
      padding: 6px 0;
    }
    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(255, 111, 97, 0.28);
    }
    input[type="color"] {
      padding: 0;
      width: 68px;
      height: 42px;
      cursor: pointer;
    }
    input[type="range"] {
      accent-color: var(--accent);
      width: 220px;
      height: 36px;
    }
    button {
      border: none;
      background: linear-gradient(135deg, var(--accent), #ffa172);
      color: #fff;
      font-weight: 600;
      padding: 10px 18px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(255, 111, 97, 0.3);
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(255, 111, 97, 0.34);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 6px 14px rgba(255, 111, 97, 0.3);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-top: 12px;
    }
    .row label {
      margin-top: 0;
      flex: 1 1 140px;
    }
    .row input[type="text"],
    .row input[type="range"] {
      flex: 2 1 220px;
    }
    .row input[type="color"] {
      flex: 0 0 auto;
    }
    .row button {
      flex: 0 0 auto;
    }
    .status {
      font-size: 0.9rem;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(24, 32, 42, 0.06);
      border: 1px solid rgba(24, 32, 42, 0.1);
      white-space: pre-wrap;
    }
    pre.status {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    }
    .value {
      font-weight: 600;
      color: #1a2530;
    }
    @media (max-width: 640px) {
      .page {
        margin: 24px auto 32px;
        padding: 0 14px 28px;
      }
      .row {
        flex-direction: column;
        align-items: stretch;
      }
      .row > * {
        width: 100%;
      }
      input[type="range"] {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <h1>ProtoGen Web Control</h1>

    <section>
      <h2>Animation Files</h2>
      <form id="uploadForm">
        <label>
          File to upload
          <input id="fileInput" type="file" accept=".json,.txt,.anim,.dat,.bin,.cfg,.csv,.yml,.yaml,.xml,.c,.h,.cpp,.hpp,.ino" required>
        </label>
        <label>
          Save as (stored in /anims/)
          <input id="fileName" type="text" placeholder="example.json" required>
        </label>
        <button type="submit">Upload</button>
      </form>
      <div id="uploadStatus" class="status"></div>

      <div class="row">
        <label for="deleteName">Delete /anims/ file:</label>
        <input id="deleteName" type="text" placeholder="example.json">
        <button id="deleteButton" type="button">Delete</button>
      </div>
      <div id="deleteStatus" class="status"></div>
    </section>

    <section>
      <h2>Emotion</h2>
      <div>Current: <span id="emotionCurrent" class="value">--</span></div>
      <div class="row">
        <input id="emotionInput" type="text" placeholder="Enter new emotion">
        <button id="emotionRefresh" type="button">Refresh</button>
        <button id="emotionUpdate" type="button">Update</button>
      </div>
      <div id="emotionStatus" class="status"></div>
    </section>

    <section>
      <h2>Fan</h2>
      <div>Duty: <span id="fanDuty" class="value">--</span> | Percent: <span id="fanPercent" class="value">--</span>%</div>
      <div class="row">
        <label for="fanSlider">Speed (%)</label>
        <input id="fanSlider" type="range" min="0" max="100" value="0">
        <span id="fanSliderValue" class="value">0%</span>
        <button id="fanRefresh" type="button">Refresh</button>
        <button id="fanApply" type="button">Apply</button>
      </div>
      <div id="fanStatus" class="status"></div>
    </section>

    <section>
      <h2>Ears</h2>
      <div>Color: <span id="earColorText" class="value">--</span> | Brightness: <span id="earBrightnessText" class="value">--</span></div>
      <div class="row">
        <label for="earColor">Color</label>
        <input id="earColor" type="color" value="#ffffff">
        <label for="earBrightness">Brightness</label>
        <input id="earBrightness" type="range" min="0" max="255" value="128">
        <span id="earBrightnessValue" class="value">128</span>
        <button id="earRefresh" type="button">Refresh</button>
        <button id="earApply" type="button">Apply</button>
      </div>
      <div id="earStatus" class="status"></div>
    </section>

    <section>
      <h2>Heap Status</h2>
      <button id="heapRefresh" type="button">Refresh</button>
      <div id="heapValue" class="status">--</div>
    </section>

    <section>
      <h2>Gyroscope</h2>
      <button id="gyroRefresh" type="button">Refresh</button>
      <pre id="gyroValue" class="status">--</pre>
    </section>

  </main>

  <script>
    (function () {
      function $(id) { return document.getElementById(id); }
      function setText(node, text) { node.textContent = text; }

      var uploadForm = $("uploadForm");
      var fileInput = $("fileInput");
      var fileNameInput = $("fileName");
      var uploadStatus = $("uploadStatus");
      var deleteInput = $("deleteName");
      var deleteStatus = $("deleteStatus");
      var emotionCurrent = $("emotionCurrent");
      var emotionInput = $("emotionInput");
      var emotionStatus = $("emotionStatus");
      var fanDuty = $("fanDuty");
      var fanPercent = $("fanPercent");
      var fanSlider = $("fanSlider");
      var fanSliderValue = $("fanSliderValue");
      var fanStatus = $("fanStatus");
      var earColor = $("earColor");
      var earColorText = $("earColorText");
      var earBrightness = $("earBrightness");
      var earBrightnessText = $("earBrightnessText");
      var earBrightnessValue = $("earBrightnessValue");
      var earStatus = $("earStatus");
      var heapValue = $("heapValue");
      var gyroValue = $("gyroValue");

      fileInput.addEventListener("change", function () {
        if (fileInput.files.length && !fileNameInput.value) {
          fileNameInput.value = fileInput.files[0].name;
        }
      });

      fanSlider.addEventListener("input", function () {
        setText(fanSliderValue, fanSlider.value + "%");
      });

      earBrightness.addEventListener("input", function () {
        setText(earBrightnessValue, earBrightness.value);
      });

      function fetchText(url, options) {
        return fetch(url, options).then(function (response) {
          return response.text().then(function (text) {
            if (!response.ok) { throw new Error(text || response.statusText); }
            return text;
          });
        });
      }

      function refreshEmotion() {
        fetchText("/emotion").then(function (text) {
          setText(emotionCurrent, text || "(empty)");
          setText(emotionStatus, "");
        }).catch(function (error) {
          setText(emotionStatus, "Error: " + error.message);
        });
      }

      function updateEmotion() {
        var value = emotionInput.value.trim();
        if (!value) {
          setText(emotionStatus, "Please enter a value.");
          return;
        }
        var body = new URLSearchParams({ name: value });
        fetchText("/emotion", {
          method: "PUT",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: body
        }).then(function (text) {
          setText(emotionStatus, text);
          refreshEmotion();
        }).catch(function (error) {
          setText(emotionStatus, "Error: " + error.message);
        });
      }

      function refreshFan() {
        fetchText("/fan").then(function (dutyString) {
          var duty = parseInt(dutyString, 10);
          var percent = isFinite(duty) ? Math.round(duty * 100 / 255) : NaN;
          setText(fanDuty, isFinite(duty) ? duty : "--");
          setText(fanPercent, isFinite(percent) ? percent : "--");
          if (isFinite(percent)) {
            fanSlider.value = percent;
            setText(fanSliderValue, percent + "%");
          }
          setText(fanStatus, "");
        }).catch(function (error) {
          setText(fanStatus, "Error: " + error.message);
        });
      }

      function applyFan() {
        var percent = parseInt(fanSlider.value, 10) || 0;
        var duty = Math.round(percent * 255 / 100);
        var body = new URLSearchParams({ duty: String(duty) });
        fetchText("/fan", {
          method: "PUT",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: body
        }).then(function (text) {
          setText(fanStatus, text);
          refreshFan();
        }).catch(function (error) {
          setText(fanStatus, "Error: " + error.message);
        });
      }

      function refreshEars() {
        fetchText("/ears").then(function (response) {
          var parts = response.trim().split(/\s+/);
          var color = (parts[0] || "#ffffff").toLowerCase();
          var brightness = parseInt(parts[1] || "0", 10);
          setText(earColorText, color);
          setText(earBrightnessText, isFinite(brightness) ? brightness : "--");
          if (/^#[0-9a-f]{6}$/i.test(color)) {
            earColor.value = color;
          }
          if (isFinite(brightness)) {
            earBrightness.value = brightness;
            setText(earBrightnessValue, brightness);
          }
          setText(earStatus, "");
        }).catch(function (error) {
          setText(earStatus, "Error: " + error.message);
        });
      }

      function applyEars() {
        var body = new URLSearchParams({
          color: earColor.value,
          brightness: earBrightness.value
        });
        fetchText("/ears", {
          method: "PUT",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: body
        }).then(function (text) {
          setText(earStatus, text);
          refreshEars();
        }).catch(function (error) {
          setText(earStatus, "Error: " + error.message);
        });
      }

      function refreshHeap() {
        fetchText("/heap").then(function (text) {
          setText(heapValue, text);
        }).catch(function (error) {
          setText(heapValue, "Error: " + error.message);
        });
      }

      function refreshGyro() {
        fetchText("/gyro").then(function (text) {
          setText(gyroValue, text);
        }).catch(function (error) {
          setText(gyroValue, "Error: " + error.message);
        });
      }

      uploadForm.addEventListener("submit", function (event) {
        event.preventDefault();
        if (!fileInput.files.length) {
          setText(uploadStatus, "Please choose a file.");
          return;
        }
        var file = fileInput.files[0];
        var name = fileNameInput.value.trim() || file.name;
        if (!name) {
          setText(uploadStatus, "File name is required.");
          return;
        }
        file.text().then(function (content) {
          var body = new URLSearchParams({ file: name, content: content });
          return fetchText("/savefile", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: body
          });
        }).then(function (text) {
          setText(uploadStatus, text);
        }).catch(function (error) {
          setText(uploadStatus, "Error: " + error.message);
        });
      });

      $("deleteButton").addEventListener("click", function () {
        var name = deleteInput.value.trim();
        if (!name) {
          setText(deleteStatus, "Enter a file name.");
          return;
        }
        fetchText("/file?file=" + encodeURIComponent(name), { method: "DELETE" })
          .then(function (text) { setText(deleteStatus, text); })
          .catch(function (error) { setText(deleteStatus, "Error: " + error.message); });
      });

      $("emotionRefresh").addEventListener("click", refreshEmotion);
      $("emotionUpdate").addEventListener("click", updateEmotion);
      $("fanRefresh").addEventListener("click", refreshFan);
      $("fanApply").addEventListener("click", applyFan);
      $("earRefresh").addEventListener("click", refreshEars);
      $("earApply").addEventListener("click", applyEars);
      $("heapRefresh").addEventListener("click", refreshHeap);
      $("gyroRefresh").addEventListener("click", refreshGyro);

      refreshEmotion();
      refreshFan();
      refreshEars();
      refreshHeap();
      refreshGyro();
    })();
  </script>
</body>
</html>
